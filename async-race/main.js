(()=>{"use strict";var t=["Nissan","Porsche","Audi","Hyundai","Ford","Volkswagen","Honda","BMW","Mercedes-Benz","Toyota"],e=["Juke","Cayenne","A4","Elantra","Fusion","Jetta","Civic","M5","G63","Camry"],n='\n  <?xml version="1.0" ?>\n  <!DOCTYPE svg  PUBLIC \'-//W3C//DTD SVG 1.1//EN\'  \'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\'>\n  <svg enable-background="new 0 0 1000 600" height="40" id="Shape_1_5_" overflow="visible" version="1.1" viewBox="0 0 1000 600" width="60" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <g id="Shape_1">\n      <g>\n        <path d="M251.99,369.532c-3.653,0-6.615,2.962-6.615,6.615s2.962,6.615,6.615,6.615s6.615-2.962,6.615-6.615    S255.644,369.532,251.99,369.532z M251.99,388.304c-1.548,0-2.804,1.256-2.804,2.805c0,1.548,1.255,2.804,2.804,2.804    c1.549,0,2.804-1.256,2.804-2.804C254.794,389.56,253.539,388.304,251.99,388.304z M259.421,396.911v22.711    c6.642-1.127,12.776-3.74,18.053-7.483l-16.059-16.059C260.767,396.387,260.103,396.667,259.421,396.911z M271.926,385.574    l16.058,16.058c3.744-5.276,6.354-11.413,7.482-18.055h-22.713C272.508,384.259,272.233,384.926,271.926,385.574z     M271.924,366.722c0.307,0.648,0.585,1.313,0.83,1.995h22.712c-1.127-6.642-3.74-12.776-7.483-18.054L271.924,366.722z     M242.566,356.215c0.649-0.308,1.313-0.587,1.995-0.831v-22.711c-6.642,1.127-12.776,3.74-18.053,7.483L242.566,356.215z     M251.99,303.936c-39.881,0-72.212,32.33-72.212,72.212s32.331,72.212,72.212,72.212c39.882,0,72.212-32.33,72.212-72.212    S291.872,303.936,251.99,303.936z M251.99,427.728c-28.487,0-51.58-23.093-51.58-51.58c0-28.486,23.093-51.58,51.58-51.58    s51.58,23.094,51.58,51.58C303.57,404.635,280.477,427.728,251.99,427.728z M251.99,363.989c1.549,0,2.804-1.256,2.804-2.805    c0-1.548-1.255-2.804-2.804-2.804c-1.548,0-2.804,1.256-2.804,2.804C249.187,362.733,250.442,363.989,251.99,363.989z     M277.474,340.155c-5.276-3.743-11.412-6.355-18.053-7.482v22.711c0.682,0.244,1.347,0.522,1.995,0.83L277.474,340.155z     M232.056,366.721l-16.058-16.059c-3.744,5.277-6.355,11.413-7.482,18.055h22.713    C231.473,368.035,231.748,367.369,232.056,366.721z M226.506,412.14c5.277,3.743,11.413,6.355,18.055,7.482v-22.711    c-0.682-0.244-1.348-0.522-1.996-0.83L226.506,412.14z M231.227,383.577h-22.711c1.127,6.642,3.739,12.777,7.482,18.055    l16.059-16.06C231.75,384.924,231.471,384.259,231.227,383.577z M239.833,376.146c0-1.549-1.255-2.804-2.804-2.804    c-1.549,0-2.804,1.255-2.804,2.804s1.255,2.804,2.804,2.804C238.577,378.95,239.833,377.695,239.833,376.146z M264.148,376.146    c0,1.549,1.255,2.804,2.804,2.804c1.549,0,2.804-1.255,2.804-2.804s-1.255-2.804-2.804-2.804    C265.403,373.343,264.148,374.598,264.148,376.146z M811.641,369.532c-3.653,0-6.615,2.962-6.615,6.615s2.962,6.615,6.615,6.615    s6.615-2.962,6.615-6.615S815.294,369.532,811.641,369.532z M802.217,356.215c0.648-0.308,1.313-0.587,1.994-0.831v-22.711    c-6.642,1.127-12.776,3.74-18.054,7.483L802.217,356.215z M811.641,388.304c-1.549,0-2.804,1.256-2.804,2.805    c0,1.548,1.255,2.804,2.804,2.804s2.804-1.256,2.804-2.804C814.444,389.56,813.189,388.304,811.641,388.304z M819.071,396.911    v22.711c6.642-1.127,12.775-3.74,18.053-7.483l-16.059-16.059C820.417,396.387,819.753,396.667,819.071,396.911z M832.402,383.577    c-0.244,0.682-0.52,1.349-0.826,1.997l16.058,16.058c3.744-5.276,6.354-11.413,7.482-18.055H832.402z M937.276,292.157    c-9.801-15.004-34.896-20.235-54.012-26.477c-133.488-32.242-177.882-21.747-200.162-24.888    c-4.495-1.199-8.503-5.123-12.179-7.413c-8.057-5.019-16.418-9.434-24.358-14.298c-13.119-8.036-73.653-41.146-90.02-47.128    c-35.963-13.142-92.818-23.68-229.815-12.708c-5.56-1.528-8.916-6.016-14.826-7.414c-5.846-1.383-11.214,1.693-15.356,2.648    c0.075,4.491-0.326,8.136-1.059,11.649c-26.775,11.291-53.869,19.953-80.488,31.242c-11.108,4.711-22.569,9.32-33.89,14.297    c-7.042,3.097-13.77,7.495-21.71,10.062c-8.624,2.786-18.051,1.527-27.536,3.706c-17.267,3.967-35.99,4.497-55.071,4.766    c-2.181,3.738-5.977,7.503-6.884,12.18c3.305,1.02,4.412,3.298,4.236,7.942c-5.84,8.653-4.274,20.981-4.236,34.949    c-12.441,6.37-14.333,29.711-11.12,48.187c-0.353,1.589-0.706,3.178-1.059,4.767c0.665,5.223,2.365,10.742,2.647,16.415    c4.672,3.133,9.968,8.167,13.238,12.709c1.595,2.215,2.371,6.033,5.295,6.884c15.631,11.41,94.785,13.768,94.785,13.768    l4.164,0.228c-0.637-3.934-0.973-7.969-0.973-12.082c0-41.478,33.625-75.102,75.102-75.102c41.478,0,75.102,33.624,75.102,75.102    c0,6.966-0.952,18.277-2.728,24.678l416.073-0.736c-2.527-7.52-3.898-15.57-3.898-23.941c0-41.478,33.624-75.102,75.102-75.102    s75.102,33.624,75.102,75.102c0,7.27-1.036,14.297-2.964,20.945l4.252-0.089c0,0,32.779-1.584,40.773-5.296    c7.994-3.711,11.12-14.297,11.12-14.297l-2.118-22.24C937.806,355.171,947.652,308.042,937.276,292.157z M272.719,237.621    c-24.887-16.535-11.702-35.842-12.373-35.781c-0.398,0.354-0.685,0.636-0.865,0.827c0.528-0.559,0.788-0.82,0.865-0.827    c6.412-5.714,43.006-31.271,172.82-31.474c4.06,22.768,8.12,52.68,12.179,75.446C393.112,244.229,290.3,245.112,272.719,237.621z     M607.381,246.088c-11.408,0-124.969-0.031-124.969-0.031s-18.331-48.33-24.887-75.157c0.763,0.07,23.298,1.055,23.298,1.055    s44.613,5.079,72.546,14.298c21.976,7.253,65.363,36.403,66.19,38.126C606.506,225.047,603.416,235.329,607.381,246.088z     M811.641,303.936c-39.882,0-72.212,32.33-72.212,72.212s32.33,72.212,72.212,72.212s72.212-32.33,72.212-72.212    S851.522,303.936,811.641,303.936z M811.641,427.728c-28.486,0-51.58-23.093-51.58-51.58c0-28.486,23.094-51.58,51.58-51.58    c28.487,0,51.58,23.094,51.58,51.58C863.221,404.635,840.128,427.728,811.641,427.728z M791.706,366.721l-16.059-16.059    c-3.743,5.277-6.354,11.413-7.481,18.055h22.713C791.123,368.035,791.398,367.369,791.706,366.721z M799.483,376.146    c0-1.549-1.256-2.804-2.805-2.804c-1.548,0-2.804,1.255-2.804,2.804s1.256,2.804,2.804,2.804    C798.228,378.95,799.483,377.695,799.483,376.146z M811.641,363.989c1.549,0,2.804-1.256,2.804-2.805    c0-1.548-1.255-2.804-2.804-2.804s-2.804,1.256-2.804,2.804C808.837,362.733,810.092,363.989,811.641,363.989z M837.125,340.155    c-5.277-3.743-11.412-6.355-18.054-7.482v22.711c0.682,0.244,1.347,0.522,1.995,0.83L837.125,340.155z M823.798,376.146    c0,1.549,1.256,2.804,2.805,2.804c1.548,0,2.804-1.255,2.804-2.804s-1.256-2.804-2.804-2.804    C825.054,373.343,823.798,374.598,823.798,376.146z M786.156,412.14c5.277,3.743,11.413,6.355,18.055,7.482v-22.711    c-0.683-0.244-1.348-0.522-1.996-0.83L786.156,412.14z M790.877,383.577h-22.711c1.127,6.642,3.739,12.777,7.482,18.055    l16.059-16.06C791.399,384.924,791.121,384.259,790.877,383.577z M832.404,368.717h22.711c-1.127-6.642-3.739-12.776-7.482-18.054    l-16.059,16.059C831.881,367.37,832.16,368.035,832.404,368.717z" fill="none"/>\n      </g>\n    </g>\n  </svg>',r={page:1,createState:{name:"",color:""},updateState:{name:"",color:""}},i={page:1,sortOptionList:[{key:"wins",force:!0},{key:"time",force:!0}]},a={duration:250,easing:"ease"},c=[{opacity:0},{opacity:1}],s=[{transform:"translateY(-200px)",opacity:0},{transform:"translateY(0)",opacity:1}],o=function(t){var e,n=t.tag,r=t.classList,i=void 0===r?void 0:r,a=t.innerText,c=void 0===a?void 0:a,s=t.attributes,o=void 0===s?void 0:s,u=document.createElement(n);return i&&(e=u.classList).add.apply(e,i),c&&(u.textContent=String(c)),o&&o.forEach((function(t){return u.setAttribute(t.name,t.value)})),u},u=function(t,e){var n=o({tag:"DIV",classList:["".concat(t,"-panel")],attributes:[{name:"id",value:t}]}),r=o({tag:"INPUT",classList:["".concat(t,"-input")],attributes:[{name:"type",value:"text"}]}),i=o({tag:"INPUT",classList:["".concat(t,"-input")],attributes:[{name:"type",value:"color"}]}),a=o({tag:"BUTTON",classList:["".concat(t,"-button")],innerText:"".concat(t," car")});return r.value=e.name,i.value=e.color,n.append(r,i,a),n},l=function(t){var e=document.querySelector(t),n=e.querySelector("input[type='text']"),r=e.querySelector("input[type='color']");return{name:n.value,color:r.value}},p=function(t,e,n){var r=document.querySelector('[data-id="'.concat(t,'"] .car-start')),i=document.querySelector('[data-id="'.concat(t,'"] .car-stop'));r.classList.toggle("disabled",e),i.classList.toggle("disabled",n)},h=function(t){var e=document.querySelector(".start-race"),n=document.querySelector(".reset-race");e.classList.toggle("disabled",!t),n.classList.toggle("disabled",t)},f=function(t){Array.from(document.querySelectorAll("button")).forEach((function(e){return e.classList.toggle("disabled",!t)}))},d=function(t,e,n,r){return new(n||(n=Promise))((function(i,a){function c(t){try{o(r.next(t))}catch(t){a(t)}}function s(t){try{o(r.throw(t))}catch(t){a(t)}}function o(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,s)}o((r=r.apply(t,e||[])).next())}))},v=function(t,e){var n,r,i,a,c={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return c.label++,{value:a[1],done:!1};case 5:c.label++,r=a[1],a=[0];continue;case 7:a=c.ops.pop(),c.trys.pop();continue;default:if(!((i=(i=c.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){c=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){c.label=a[1];break}if(6===a[0]&&c.label<i[1]){c.label=i[1],i=a;break}if(i&&c.label<i[2]){c.label=i[2],c.ops.push(a);break}i[2]&&c.ops.pop(),c.trys.pop();continue}a=e.call(t,c)}catch(t){a=[6,t],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};const g=function(){function t(t){this.url="".concat(t,"/garage"),this.carLimit=7}return t.prototype.getCar=function(t){return d(this,void 0,void 0,(function(){return v(this,(function(e){switch(e.label){case 0:return[4,fetch("".concat(this.url,"/").concat(t),{method:"GET"})];case 1:return[4,e.sent().json()];case 2:return[2,e.sent()]}}))}))},t.prototype.getCars=function(t){return d(this,void 0,void 0,(function(){var e;return v(this,(function(n){switch(n.label){case 0:return e=this.url,t&&(e+="?_page=".concat(t,"&_limit=").concat(this.carLimit)),[4,fetch(e,{method:"GET"})];case 1:return[4,n.sent().json()];case 2:return[2,n.sent()]}}))}))},t.prototype.createCar=function(t){return d(this,void 0,void 0,(function(){return v(this,(function(e){switch(e.label){case 0:return[4,fetch(this.url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})];case 1:return[4,e.sent().json()];case 2:return[2,e.sent()]}}))}))},t.prototype.updateCar=function(t,e){return d(this,void 0,void 0,(function(){var n;return v(this,(function(r){switch(r.label){case 0:return n="".concat(this.url,"/").concat(t),[4,fetch(n,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})];case 1:return[4,r.sent().json()];case 2:return[2,r.sent()]}}))}))},t.prototype.deleteCar=function(t){return d(this,void 0,void 0,(function(){var e;return v(this,(function(n){switch(n.label){case 0:return e="".concat(this.url,"/").concat(t),[4,fetch(e,{method:"DELETE"})];case 1:return n.sent(),[2]}}))}))},t}();var y=function(t,e,n,r){return new(n||(n=Promise))((function(i,a){function c(t){try{o(r.next(t))}catch(t){a(t)}}function s(t){try{o(r.throw(t))}catch(t){a(t)}}function o(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,s)}o((r=r.apply(t,e||[])).next())}))},w=function(t,e){var n,r,i,a,c={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return c.label++,{value:a[1],done:!1};case 5:c.label++,r=a[1],a=[0];continue;case 7:a=c.ops.pop(),c.trys.pop();continue;default:if(!((i=(i=c.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){c=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){c.label=a[1];break}if(6===a[0]&&c.label<i[1]){c.label=i[1],i=a;break}if(i&&c.label<i[2]){c.label=i[2],c.ops.push(a);break}i[2]&&c.ops.pop(),c.trys.pop();continue}a=e.call(t,c)}catch(t){a=[6,t],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};const b=function(){function t(t){this.url="".concat(t,"/winners"),this.limit=10}return t.prototype.getWinner=function(t){return y(this,void 0,void 0,(function(){var e;return w(this,(function(n){switch(n.label){case 0:return[4,fetch("".concat(this.url,"/").concat(t),{method:"GET"})];case 1:if(!(e=n.sent()).ok)throw Error("no saved winners, just try create new");return[4,e.json()];case 2:return[2,n.sent()]}}))}))},t.prototype.getWinners=function(t){return y(this,void 0,void 0,(function(){var e;return w(this,(function(n){switch(n.label){case 0:return e=this.url,t&&(e+="?_page=".concat(t,"&_limit=").concat(this.limit)),[4,fetch(e,{method:"GET"})];case 1:return[4,n.sent().json()];case 2:return[2,n.sent()]}}))}))},t.prototype.setWinner=function(t){return y(this,void 0,void 0,(function(){var e,n;return w(this,(function(r){switch(r.label){case 0:return e=Number((t.carAnimation.currentTime/1e3).toFixed(2)),n={id:t.id,time:e,wins:1},[4,fetch(this.url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})];case 1:return r.sent(),[2]}}))}))},t.prototype.updateWinner=function(t){return y(this,void 0,void 0,(function(){var e,n,r,i,a;return w(this,(function(c){switch(c.label){case 0:return e=t.id,n=t.time,r=t.wins,[4,this.getWinner(e)];case 1:return i=c.sent(),a={time:Math.min(i.time,n),wins:r+1},[4,fetch("".concat(this.url,"/").concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})];case 2:return c.sent(),[2]}}))}))},t}();var m=function(){return m=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},m.apply(this,arguments)},C=function(t,e,n,r){return new(n||(n=Promise))((function(i,a){function c(t){try{o(r.next(t))}catch(t){a(t)}}function s(t){try{o(r.throw(t))}catch(t){a(t)}}function o(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,s)}o((r=r.apply(t,e||[])).next())}))},L=function(t,e){var n,r,i,a,c={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return c.label++,{value:a[1],done:!1};case 5:c.label++,r=a[1],a=[0];continue;case 7:a=c.ops.pop(),c.trys.pop();continue;default:if(!((i=(i=c.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){c=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){c.label=a[1];break}if(6===a[0]&&c.label<i[1]){c.label=i[1],i=a;break}if(i&&c.label<i[2]){c.label=i[2],c.ops.push(a);break}i[2]&&c.ops.pop(),c.trys.pop();continue}a=e.call(t,c)}catch(t){a=[6,t],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};const T=function(){function t(t){this.baseUrl=t,this.currentPage=1,this.sortOptionList=null,this.prevSortOption=null,this.winnersList=o({tag:"UL",classList:["winners-list"]}),this.winnersControls=new b(t),this.garageControls=new g(t)}return t.prototype.init=function(){return C(this,void 0,void 0,(function(){var t,e,n,r,a,c,s,u,l,p,h,f,d,v,g=this;return L(this,(function(y){switch(y.label){case 0:return(t=document.getElementById("root")).replaceChildren(),e=JSON.parse(localStorage.getItem("userWinnersState")),r=(n=e||i).prevSortOption,a=n.sortOptionList,c=n.page,this.prevSortOption=r,this.sortOptionList=a,this.currentPage=c,s=function(t){var e=o({tag:"DIV",classList:["winners-container"]}),n=o({tag:"BUTTON",classList:["garage-route"],innerText:"TO GARAGE"}),r=o({tag:"H2",classList:["winners-title"],innerText:"Winners"}),i=o({tag:"DIV",classList:["winners-table"]}),a=o({tag:"DIV",classList:["winners-heading"]}),c=o({tag:"DIV",classList:["winner-number"],innerText:"Number"}),s=o({tag:"DIV",classList:["winner-car"],innerText:"Car"}),u=o({tag:"DIV",classList:["winner-name"],innerText:"Name"}),l=o({tag:"DIV",classList:["winner-wins","clickable"],innerText:"Wins"}),p=o({tag:"DIV",classList:["winner-time","clickable"],innerText:"Best Time(ms)"}),h=o({tag:"DIV",classList:["page-controls"]}),f=o({tag:"BUTTON",classList:["page-button"],innerText:"< prev"}),d=o({tag:"SPAN",classList:["page-description"]}),v=o({tag:"BUTTON",classList:["page-button"],innerText:"next >"});return a.append(c,s,u,l,p),h.append(f,d,v),i.append(a,t),e.append(n,r,h,i),{panel:e,controls:[n,f,v,l,p]}}(this.winnersList),u=s.panel,l=s.controls,p=l[0],h=l[1],f=l[2],d=l[3],v=l[4],p.addEventListener("click",(function(){return g.goToGarage()})),h.addEventListener("click",(function(){return g.renderWinners(-1)})),f.addEventListener("click",(function(){return g.renderWinners(1)})),[d,v].forEach((function(t,e){var n=g.sortOptionList[e];t.addEventListener("click",(function(){return g.sortBy(n)}))})),t.append(u),[4,this.renderWinners()];case 1:return y.sent(),r&&this.sortBy(r),this.updatePageDescription(),[2]}}))}))},t.prototype.renderWinners=function(t){return C(this,void 0,void 0,(function(){var e,r,i,a,c=this;return L(this,(function(s){switch(s.label){case 0:return t&&(this.currentPage+=t),[4,this.winnersControls.getWinners(this.currentPage)];case 1:return e=s.sent(),this.currentPage<1?(this.currentPage=1,this.renderWinners(),[2]):this.currentPage>1&&!e.length?(this.renderWinners(-1),[2]):[4,Promise.all(e.map((function(t){return C(c,void 0,void 0,(function(){var e;return L(this,(function(n){switch(n.label){case 0:return[4,this.garageControls.getCar(t.id)];case 1:return e=n.sent(),[2,m(m({},t),e)]}}))}))})))];case 2:return r=s.sent(),i=r.map((function(t){return function(t){var e=t.id,r=t.name,i=t.color,a=t.wins,c=t.time,s=o({tag:"LI",classList:["winners-item"]}),u=o({tag:"DIV",classList:["winner-number"],innerText:e}),l=o({tag:"DIV",classList:["winner-car"],innerText:"Car"});l.innerHTML=n,l.querySelector("path").style.fill=i;var p=o({tag:"DIV",classList:["winner-name"],innerText:r}),h=o({tag:"DIV",classList:["winner-wins"],innerText:a}),f=o({tag:"DIV",classList:["winner-time"],innerText:c});return s.append(u,l,p,h,f),s}(t)})),this.winnersList.replaceChildren(),(a=this.winnersList).append.apply(a,i),this.updatePageDescription(),[2]}}))}))},t.prototype.updatePageDescription=function(){return C(this,void 0,void 0,(function(){var t;return L(this,(function(e){switch(e.label){case 0:return[4,this.winnersControls.getWinners()];case 1:return t=e.sent(),document.querySelector(".page-description").textContent="Page #".concat(this.currentPage," (").concat(t.length,")"),[2]}}))}))},t.prototype.sortBy=function(t){var e;this.prevSortOption=m({},t);var n=t.key,r=t.force,i=Array.from(this.winnersList.children).sort((function(t,e){var i=Number(t.querySelector(".winner-".concat(n)).textContent),a=Number(e.querySelector(".winner-".concat(n)).textContent);return r?a-i:i-a}));(e=this.winnersList).replaceChildren.apply(e,i),this.sortOptionList.find((function(e){return t.key===e.key})).force=!r},t.prototype.goToGarage=function(){var t={page:this.currentPage,sortOptionList:this.sortOptionList,prevSortOption:this.prevSortOption};localStorage.setItem("userWinnersState",JSON.stringify(t)),new z(this.baseUrl).init()},t}();var S=function(t,e,n,r){return new(n||(n=Promise))((function(i,a){function c(t){try{o(r.next(t))}catch(t){a(t)}}function s(t){try{o(r.throw(t))}catch(t){a(t)}}function o(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,s)}o((r=r.apply(t,e||[])).next())}))},x=function(t,e){var n,r,i,a,c={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return c.label++,{value:a[1],done:!1};case 5:c.label++,r=a[1],a=[0];continue;case 7:a=c.ops.pop(),c.trys.pop();continue;default:if(!((i=(i=c.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){c=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){c.label=a[1];break}if(6===a[0]&&c.label<i[1]){c.label=i[1],i=a;break}if(i&&c.label<i[2]){c.label=i[2],c.ops.push(a);break}i[2]&&c.ops.pop(),c.trys.pop();continue}a=e.call(t,c)}catch(t){a=[6,t],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};const k=function(){function t(t){this.url="".concat(t,"/engine")}return t.prototype.stop=function(t){return S(this,void 0,void 0,(function(){var e;return x(this,(function(n){switch(n.label){case 0:return e="".concat(this.url,"?id=").concat(t,"&status"),[4,fetch("".concat(e,"=stopped"),{method:"PATCH"})];case 1:return n.sent(),[2]}}))}))},t.prototype.start=function(t){return S(this,void 0,void 0,(function(){var e,n;return x(this,(function(r){switch(r.label){case 0:return e="".concat(this.url,"?id=").concat(t,"&status"),[4,fetch("".concat(e,"=started"),{method:"PATCH"})];case 1:return[4,r.sent().json()];case 2:return n=r.sent(),[2,Math.round(n.distance/n.velocity)]}}))}))},t.prototype.drive=function(t){return S(this,void 0,void 0,(function(){var e;return x(this,(function(n){switch(n.label){case 0:return e="".concat(this.url,"?id=").concat(t,"&status"),[4,fetch("".concat(e,"=drive"),{method:"PATCH"})];case 1:return[2,n.sent()]}}))}))},t}();var P=function(t,e,n){if(n||2===arguments.length)for(var r,i=0,a=e.length;i<a;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))};const I=function(){function t(){var t=this;this.wrapper=o({tag:"DIV",classList:["popup-wrapper"]}),this.element=o({tag:"DIV",classList:["popup"]}),this.wrapper.append(this.element),this.isActive=!1,this.wrapper.addEventListener("click",(function(){return t.destroy()}))}return t.prototype.draw=function(t){var e=this;this.isActive||(this.isActive=!0,this.element.textContent=t,document.body.append(this.wrapper),this.toggleWrapper(!0).onfinish=function(){e.wrapper.classList.add("active"),e.toggleWindow(!0).onfinish=function(){return e.element.classList.add("active")}})},t.prototype.destroy=function(){var t=this;this.toggleWindow(!1).onfinish=function(){t.element.classList.remove("active"),t.toggleWrapper(!1).onfinish=function(){t.element.classList.remove("active"),t.wrapper.remove(),t.isActive=!1}}},t.prototype.toggleWrapper=function(t){var e=t?c:P([],c,!0).reverse();return this.wrapper.animate(e,a)},t.prototype.toggleWindow=function(t){var e=t?s:P([],s,!0).reverse();return this.element.animate(e,a)},t}();var E=function(t,e,n,r){return new(n||(n=Promise))((function(i,a){function c(t){try{o(r.next(t))}catch(t){a(t)}}function s(t){try{o(r.throw(t))}catch(t){a(t)}}function o(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,s)}o((r=r.apply(t,e||[])).next())}))},M=function(t,e){var n,r,i,a,c={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return c.label++,{value:a[1],done:!1};case 5:c.label++,r=a[1],a=[0];continue;case 7:a=c.ops.pop(),c.trys.pop();continue;default:if(!((i=(i=c.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){c=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){c.label=a[1];break}if(6===a[0]&&c.label<i[1]){c.label=i[1],i=a;break}if(i&&c.label<i[2]){c.label=i[2],c.ops.push(a);break}i[2]&&c.ops.pop(),c.trys.pop();continue}a=e.call(t,c)}catch(t){a=[6,t],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};const O=function(){function t(t){this.isRace=!1,this.activeRacers=[],this.winnerControls=new b(t),this.engineControls=new k(t),this.garageControls=new g(t),this.popup=new I}return t.prototype.prepareCar=function(t){return E(this,void 0,void 0,(function(){var e;return M(this,(function(n){switch(n.label){case 0:return this.isRace||p(t,!0,!0),-1!==(e=this.activeRacers.findIndex((function(e){return e.id===t})))&&this.activeRacers.splice(e,1),[4,this.engineControls.start(t)];case 1:return[2,n.sent()]}}))}))},t.prototype.driveCar=function(t,e){return E(this,void 0,void 0,(function(){var n,r;return M(this,(function(i){switch(i.label){case 0:return this.isRace||p(t,!0,!1),n=function(t,e){var n=document.querySelector('.car-item[data-id="'.concat(t,'"] .car')),r="calc(100% - ".concat(n.offsetWidth,"px)"),i=n.animate([{left:0},{left:r}],{duration:e}),a={id:t,carAnimation:i,isActive:!0,raceTime:e};return i.oncancel=function(){a.isActive=!1,n.style.left="0"},i.onfinish=function(){var t=a.carAnimation.currentTime;a.carAnimation.currentTime=t,a.isActive&&(n.style.left=r)},a}(t,e),this.activeRacers.push(n),[4,this.engineControls.drive(t)];case 1:return 200===(r=i.sent()).status&&n.isActive?n.carAnimation.finish():500===r.status&&(n.isActive=!1,n.carAnimation.pause()),[2,n]}}))}))},t.prototype.startCar=function(t){return E(this,void 0,void 0,(function(){var e;return M(this,(function(n){switch(n.label){case 0:return[4,this.prepareCar(t)];case 1:return e=n.sent(),[4,this.driveCar(t,e)];case 2:return[2,n.sent()]}}))}))},t.prototype.stopCar=function(t){return E(this,void 0,void 0,(function(){var e,n;return M(this,(function(r){switch(r.label){case 0:return this.isRace||p(t,!1,!0),e=this.activeRacers.findIndex((function(e){return e.id===t})),n=this.activeRacers[e],this.activeRacers.splice(e,1),n.carAnimation.cancel(),[4,this.engineControls.stop(t)];case 1:return r.sent(),[2]}}))}))},t.prototype.startRace=function(t){return E(this,void 0,void 0,(function(){var e,n,r,i,a,c,s,o,u=this;return M(this,(function(l){switch(l.label){case 0:return this.isRace=!0,f(!1),[4,this.garageControls.getCars(t)];case 1:return e=l.sent(),n=e.map((function(t){return t.id})),[4,Promise.all(n.map((function(t){return E(u,void 0,void 0,(function(){return M(this,(function(e){switch(e.label){case 0:return[4,this.prepareCar(t)];case 1:return[2,e.sent()]}}))}))})))];case 2:return r=l.sent(),[4,Promise.all(n.map((function(t,e){return E(u,void 0,void 0,(function(){return M(this,(function(n){switch(n.label){case 0:return[4,this.driveCar(t,r[e])];case 1:return[2,n.sent()]}}))}))})))];case 3:return i=l.sent(),h(!1),a=i.filter((function(t){return t.isActive})),c=a.reduce((function(t,e){return t.raceTime>e.raceTime?e:t}),a[0]),[4,this.garageControls.getCar(c.id)];case 4:s=l.sent(),this.popup.draw("".concat(s.name," finished in ").concat(c.raceTime,"ms!!!")),l.label=5;case 5:return l.trys.push([5,8,,10]),[4,this.winnerControls.getWinner(c.id)];case 6:return o=l.sent(),[4,this.winnerControls.updateWinner(o)];case 7:return l.sent(),[3,10];case 8:return l.sent(),[4,this.winnerControls.setWinner(c)];case 9:return l.sent(),[3,10];case 10:return[2]}}))}))},t.prototype.resetRace=function(t){return E(this,void 0,void 0,(function(){var e,n,r=this;return M(this,(function(i){switch(i.label){case 0:return[4,this.garageControls.getCars(t)];case 1:return e=i.sent(),n=e.map((function(t){return t.id})),[4,Promise.all(n.map((function(t){return E(r,void 0,void 0,(function(){return M(this,(function(e){switch(e.label){case 0:return[4,this.stopCar(t)];case 1:return e.sent(),[2]}}))}))})))];case 2:return i.sent(),f(!0),h(!0),this.isRace=!1,[2]}}))}))},t}();var D=function(t,e,n,r){return new(n||(n=Promise))((function(i,a){function c(t){try{o(r.next(t))}catch(t){a(t)}}function s(t){try{o(r.throw(t))}catch(t){a(t)}}function o(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,s)}o((r=r.apply(t,e||[])).next())}))},N=function(t,e){var n,r,i,a,c={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;c;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return c.label++,{value:a[1],done:!1};case 5:c.label++,r=a[1],a=[0];continue;case 7:a=c.ops.pop(),c.trys.pop();continue;default:if(!((i=(i=c.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){c=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){c.label=a[1];break}if(6===a[0]&&c.label<i[1]){c.label=i[1],i=a;break}if(i&&c.label<i[2]){c.label=i[2],c.ops.push(a);break}i[2]&&c.ops.pop(),c.trys.pop();continue}a=e.call(t,c)}catch(t){a=[6,t],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};const z=function(){function i(t){this.currentPage=1,this.baseUrl=t,this.carElemList=o({tag:"UL",classList:["car-list"]}),this.garageControls=new g(t),this.raceField=new O(t),this.selectedId=null}return i.prototype.renderCars=function(t){return D(this,void 0,void 0,(function(){var e,r=this;return N(this,(function(i){switch(i.label){case 0:return t&&(this.currentPage+=t),[4,this.garageControls.getCars(this.currentPage)];case 1:return e=i.sent(),this.currentPage<1?(this.currentPage=1,this.renderCars(),[2]):this.currentPage>1&&!e.length?(this.renderCars(-1),[2]):(this.carElemList.replaceChildren(),e.forEach((function(t){var e=function(t){var e=t.name,r=t.color,i=o({tag:"LI",classList:["car-item"]}),a=o({tag:"DIV",classList:["car-controls"]}),c=o({tag:"SPAN",classList:["car-title"],innerText:e}),s=o({tag:"BUTTON",classList:["car-select"],innerText:"select"}),u=o({tag:"BUTTON",classList:["car-remove"],innerText:"remove"}),l=o({tag:"BUTTON",classList:["car-start"],innerText:"start"}),p=o({tag:"BUTTON",classList:["car-stop","disabled"],innerText:"stop"}),h=o({tag:"DIV",classList:["car-container"]}),f=o({tag:"DIV",classList:["car"]});return f.innerHTML=n,f.querySelector("path").style.fill=r,i.dataset.id=String(t.id),a.append(s,u,l,p,c),i.append(a,h),h.append(f),{panel:i,controls:[s,u,l,p]}}(t),i=e.panel,a=e.controls,c=a[0],s=a[1],u=a[2],l=a[3];c.addEventListener("click",(function(){return r.selectCar(t.id)})),s.addEventListener("click",(function(){return r.removeCar(t.id)})),u.addEventListener("click",(function(){return r.raceField.startCar(t.id)})),l.addEventListener("click",(function(){return r.raceField.stopCar(t.id)})),r.carElemList.append(i)})),this.updatePageDescription(),[2])}}))}))},i.prototype.selectCar=function(t){return D(this,void 0,void 0,(function(){return N(this,(function(e){switch(e.label){case 0:return this.selectedId=t,[4,this.garageControls.getCar(t)];case 1:return".update-panel",n=e.sent(),i=(r=document.querySelector(".update-panel")).querySelector("input[type='text']"),a=r.querySelector("input[type='color']"),i.value=n.name,a.value=n.color,[2]}var n,r,i,a}))}))},i.prototype.removeCar=function(t){return D(this,void 0,void 0,(function(){return N(this,(function(e){switch(e.label){case 0:return[4,this.garageControls.deleteCar(t)];case 1:return e.sent(),[4,this.renderCars()];case 2:return e.sent(),this.updatePageDescription(),[2]}}))}))},i.prototype.init=function(){var t=this,e=document.getElementById("root");e.replaceChildren();var n=JSON.parse(localStorage.getItem("userGarageState"));n||(n=r),n.selectedID&&(this.selectedId=n.selectedID),this.currentPage=n.page;var i=o({tag:"DIV",classList:["garage"]}),a=function(t){var e=t.createState,n=t.updateState,r=o({tag:"BUTTON",classList:["winners-route"],innerText:"TO WINNERS"}),i=o({tag:"H2",classList:["garage-title"],innerText:"Garage"}),a=o({tag:"DIV",classList:["control-panel"]}),c=o({tag:"DIV",classList:["race-panel"]}),s=u("create",e),l=u("update",n),p=s.querySelector("button"),h=l.querySelector("button"),f=o({tag:"DIV",classList:["page-container"]}),d=o({tag:"BUTTON",classList:["page-button"],innerText:"< prev"}),v=o({tag:"BUTTON",classList:["page-button"],innerText:"next >"}),g=o({tag:"SPAN",classList:["page-description"]}),y=o({tag:"BUTTON",classList:["generate-button"],innerText:"generate cars"}),w=o({tag:"BUTTON",classList:["start-race"],innerText:"start race"}),b=o({tag:"BUTTON",classList:["reset-race","disabled"],innerText:"reset race"});return f.append(d,g,v),c.append(y,w,b),a.append(r,i,s,l,c,f),{panel:a,controls:[r,p,h,y,d,v,w,b]}}(n),c=a.panel,s=a.controls,l=s[0],p=s[1],h=s[2],f=s[3],d=s[4],v=s[5],g=s[6],y=s[7];l.addEventListener("click",(function(){return t.goToWinners()})),p.addEventListener("click",(function(){return t.addCar()})),h.addEventListener("click",(function(){return t.updateCar()})),f.addEventListener("click",(function(){return t.generateCars()})),d.addEventListener("click",(function(){return t.renderCars(-1)})),v.addEventListener("click",(function(){return t.renderCars(1)})),g.addEventListener("click",(function(){return t.raceField.startRace(t.currentPage)})),y.addEventListener("click",(function(){return t.raceField.resetRace(t.currentPage)})),i.append(c,this.carElemList),e.append(i),this.renderCars()},i.prototype.updatePageDescription=function(){return D(this,void 0,void 0,(function(){var t,e;return N(this,(function(n){switch(n.label){case 0:return[4,this.garageControls.getCars()];case 1:return t=n.sent(),e="page ".concat(this.currentPage," (").concat(t.length," cars)"),document.querySelector(".page-description").textContent=e,[2]}}))}))},i.prototype.addCar=function(){return D(this,void 0,void 0,(function(){var t;return N(this,(function(e){switch(e.label){case 0:return t=l(".create-panel"),[4,this.garageControls.createCar(t)];case 1:return e.sent(),[4,this.renderCars()];case 2:return e.sent(),[2]}}))}))},i.prototype.updateCar=function(){return D(this,void 0,void 0,(function(){var t;return N(this,(function(e){switch(e.label){case 0:return this.selectedId?(t=l(".update-panel"),[4,this.garageControls.updateCar(this.selectedId,t)]):[3,2];case 1:e.sent(),this.renderCars(),e.label=2;case 2:return[2]}}))}))},i.prototype.generateCars=function(){return D(this,void 0,void 0,(function(){var n,r=this;return N(this,(function(i){switch(i.label){case 0:return n=new Array(100).fill(0).map((function(){var n,r,i;return{name:(n=t[Math.floor(Math.random()*t.length)],r=e[Math.floor(Math.random()*e.length)],"".concat(n," ").concat(r)),color:(i=Math.floor(16777215*Math.random()).toString(16),"#".concat(i))}})),[4,Promise.all(n.map((function(t){return D(r,void 0,void 0,(function(){return N(this,(function(e){switch(e.label){case 0:return[4,this.garageControls.createCar(t)];case 1:return[2,e.sent()]}}))}))})))];case 1:return i.sent(),this.renderCars(),[2]}}))}))},i.prototype.goToWinners=function(){var t={page:this.currentPage,selectedID:this.selectedId,createState:l(".create-panel"),updateState:l(".update-panel")};localStorage.setItem("userGarageState",JSON.stringify(t)),new T(this.baseUrl).init()},i}();(new(function(){function t(){this.baseUrl="http://127.0.0.1:3000"}return t.prototype.init=function(){new z(this.baseUrl).init(),window.addEventListener("beforeunload",t.resetState)},t.resetState=function(){localStorage.removeItem("userGarageState"),localStorage.removeItem("userWinnersState")},t}())).init()})();
//# sourceMappingURL=main.js.map